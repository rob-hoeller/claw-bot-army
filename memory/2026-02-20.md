# Memory Log — 2026-02-20

## Attachment Upload Fix

### Branch: `hbx/fix-attachment-upload` (NO PR yet — user wants to test first)
### Commits: 57cdc64, 88aed72, a9dd5ea

### Root Cause (ACTUAL — found 2026-02-20)
OpenClaw's `/v1/responses` endpoint silently drops `input_file` parts — they never reach the model. Only `input_image` and `input_text` are forwarded. The send route was using `input_file` for all non-image attachments, so files were sent but never seen by the AI.

Previous theory (Supabase re-fetch timeout) was a secondary issue, also fixed.

### Fix Applied
1. **Client sends base64 inline**: ChatInput captures raw base64 alongside Supabase upload, passes it in the send payload
2. **Send route uses inline base64**: `resolveAttachment` prefers `base64Data` field, falls back to URL fetch
3. **Default text for file-only sends**: When user uploads file with no text, auto-adds "Please analyze the attached file"
4. **Error visibility**: Failed attachments now add `[Failed to load attachment: filename]` instead of being silently dropped
5. **Size guard**: Files > 3MB skip inline base64 (to stay under Vercel body limits) and fall back to URL fetch
6. **Vercel timeout**: Added `maxDuration = 60` for streaming responses

### Testing Needed
- Paperclip file upload (the original bug)
- Image paste (Ctrl+V) — regression test
- Drag-and-drop file — regression test
- Large file (> 3MB) via paperclip
- iPhone upload

### Key Files Modified
- `dashboard/src/components/chat/types.ts` — added `base64Data` to Attachment
- `dashboard/src/components/chat/ChatInput.tsx` — capture raw base64, 3MB cap
- `dashboard/src/components/chat/ChatPanel.tsx` — pass base64Data in send, strip from persist
- `dashboard/src/app/api/chat/send/route.ts` — use inline base64, better error handling
