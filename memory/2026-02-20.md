# Memory Log â€” 2026-02-20

## Image & File Upload Pipeline: PR #40 Submitted

### PR: https://github.com/rob-hoeller/claw-bot-army/pull/40
### Branch: `hbx/workitem-live-bridge` (KEEP OPEN)

### What Works âœ…
- **Image paste** (Ctrl+V) â€” AI sees and describes images
- **Image drag-and-drop** â€” AI sees and describes images
- **File drag-and-drop** â€” AI reads/summarizes .md, .json, .pdf, etc.
- **Paperclip/Image button** â€” opens file explorer, shows preview

### Open Issue: Paperclip File Upload ðŸ”§
- File picker opens, file shows in pending preview, upload to Supabase succeeds
- But after send, AI doesn't see the file content
- Drag-and-drop works for same files â€” identical code path
- Latest commit `78bb865` re-enables session key for `/v1/responses` â€” needs testing
- If still broken, may be a race condition or event handling difference

### Architecture
- Dual endpoint: `/v1/responses` (attachments), `/v1/chat/completions` (text-only)
- Gateway `/v1/chat/completions` strips `image_url` via `extractTextContent` â€” can't use for images
- `/v1/responses` uses `input_image` (base64) and `input_file` (base64) parts
- `type: "message"` required on all input items (OpenResponses strict schema)
- MIME resolver: 30+ extensionâ†’MIME mappings for browser `application/octet-stream` fix
- SSE parser handles both streaming formats
- Session key + `/v1/responses` interaction is fragile â€” caused hangs earlier

### Key Files
- `dashboard/src/app/api/chat/send/route.ts` â€” dual endpoint, MIME resolver
- `dashboard/src/app/api/chat/upload/route.ts` â€” Supabase Storage upload
- `dashboard/src/components/chat/ChatInput.tsx` â€” drag-drop, paste, file picker
- `dashboard/src/components/chat/ChatPanel.tsx` â€” dual SSE parser

### Debugging Rules Added to AGENTS.md
1. Don't Volley â€” own the problem
2. Test Before You Ship
3. Understand the Full Stack
4. Check Response Formats
5. One Round Trip Max
6. When Stuck, Step Back
7. Stay on the Active Branch
