# Memory Log — 2025-02-20

## Image Upload Pipeline: COMPLETE ✅

### What We Built
Dashboard webchat now supports image uploads end-to-end:
- User pastes/uploads image → Supabase Storage upload → base64 sent to Gateway `/v1/responses` → AI sees and describes the image → streaming response rendered in chat

### Key Technical Decisions
- `/v1/chat/completions` is TEXT ONLY — `extractTextContent` strips all `image_url` parts
- `/v1/responses` supports `input_image` with `source: { type: "base64", media_type, data }`
- Dual endpoint strategy: images → `/v1/responses`, text-only → `/v1/chat/completions`
- SSE parser updated to handle both streaming formats (`response.output_text.delta` vs `choices[0].delta.content`)
- Supabase `chat-media` bucket is public for direct URL access
- Base64 stripped from DB persistence to avoid oversized payloads

### Files Modified
- `dashboard/src/app/api/chat/upload/route.ts` (new)
- `dashboard/src/app/api/chat/send/route.ts` (dual endpoint + image format)
- `dashboard/src/app/api/chat/messages/route.ts` (allow empty content with attachments)
- `dashboard/src/components/chat/ChatInput.tsx` (paste/upload handler)
- `dashboard/src/components/chat/ChatPanel.tsx` (dual SSE parser)

### Lessons Learned
- Don't ask the user to debug — test server-side first
- Trace the FULL request chain before coding a fix
- When switching APIs, always verify response format matches client parser
- Look at what already works (Telegram) and replicate that path

### TODO
- [ ] Remove debug console.log statements
- [ ] Create PR and merge to main
- [ ] Test on production
